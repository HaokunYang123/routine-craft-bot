# Milestone v2.0: Performance

**Status:** SHIPPED 2026-01-28
**Phases:** 9-14
**Total Plans:** 17

## Overview

Optimize data fetching, rendering, and large dataset handling for faster, smoother user experience. Full React Query migration with optimistic updates, infinite scroll pagination, and CoachCalendar memoization.

## Phases

### Phase 9: React Query Foundation

**Goal**: Establish query infrastructure without changing hook interfaces.
**Depends on**: Phase 8 (v1 complete)
**Requirements**: RQ-01 (caching), RQ-04 (background refetch), RQ-05 (deduplication)
**Plans**: 1 plan

Plans:
- [x] 09-01-PLAN.md — Query key factory + QueryClient configuration

**Details:**
- Created query key factory with hierarchical keys for all 6 entities
- Configured QueryClient with 5-min staleTime, 30-min gcTime
- Added auth-aware retry (skip 401/403)
- Global queryCache.onError with handleError

### Phase 10: Simple Hook Migration

**Goal**: Migrate low-complexity hooks to React Query pattern.
**Depends on**: Phase 9
**Requirements**: RQ-02 (loading states), RQ-03 (error states)
**Plans**: 3 plans

Plans:
- [x] 10-01-PLAN.md — useProfile migration + tests
- [x] 10-02-PLAN.md — useGroups migration + test updates
- [x] 10-03-PLAN.md — useTemplates migration + tests

**Details:**
- Replaced useState/useEffect with useQuery
- Maintained backward-compatible interface
- Added isFetching, isError, error properties
- 56 tests across 3 hooks

### Phase 11: Complex Hook Migration

**Goal**: Migrate high-complexity hooks with nested queries.
**Depends on**: Phase 10
**Requirements**: RQ-02 (loading states), RQ-03 (error states)
**Plans**: 3 plans

Plans:
- [x] 11-01-PLAN.md — useAssignments migration (utility pattern + fetchQuery)
- [x] 11-02-PLAN.md — useRecurringSchedules migration (useQuery + parallel enrichment)
- [x] 11-03-PLAN.md — useStickers migration (useQueries + combine)

**Details:**
- fetchQuery for on-demand utility hooks
- Promise.all for parallel enrichment
- useQueries with combine for multi-source data
- 83 tests across 3 hooks

### Phase 12: Mutations & Optimistic Updates

**Goal**: Add mutation patterns with query invalidation and optimistic updates.
**Depends on**: Phase 11
**Requirements**: RQ-06 (mutation feedback), RQ-07 (query invalidation), RQ-08 (optimistic updates)
**Plans**: 4 plans

Plans:
- [x] 12-01-PLAN.md — Toast duration + useGroups useMutation migration
- [x] 12-02-PLAN.md — useTemplates + useProfile useMutation migration
- [x] 12-03-PLAN.md — useAssignments optimistic updates (task completion)
- [x] 12-04-PLAN.md — Student components integration

**Details:**
- All 10 mutations use useMutation with invalidateQueries
- Task completion has optimistic updates with rollback
- No toast for frequent task completion (reduces noise)
- User-friendly error messages
- 100 tests across 4 hook test suites

### Phase 13: Pagination

**Goal**: Add cursor-based pagination and infinite scroll for large datasets.
**Depends on**: Phase 12
**Requirements**: PAG-01 to PAG-05
**Plans**: 3 plans

Plans:
- [x] 13-01-PLAN.md — Query key factory + useInfiniteClients hook + useLocalStorage
- [x] 13-02-PLAN.md — Pagination UI components (parallel with 13-01)
- [x] 13-03-PLAN.md — People.tsx integration

**Details:**
- useInfiniteQuery with created_at cursor for stable pagination
- InfiniteScrollSentinel with 100px rootMargin for preloading
- PageSizeSelector (10/25/50) with localStorage persistence
- ListStatus shows loading indicator and "That's everything"
- Lazy student loading on group expand
- 12 tests passing

### Phase 14: Render Optimization

**Goal**: Profile and optimize render performance with selective memoization.
**Depends on**: Phase 13
**Requirements**: OPT-01 to OPT-04
**Plans**: 3 plans

Plans:
- [x] 14-01-PLAN.md — Shimmer animation + page skeletons + LoadingButton timeout
- [x] 14-02-PLAN.md — Performance profiling utilities + baseline documentation
- [x] 14-03-PLAN.md — CoachCalendar memoization (React.memo + useCallback)

**Details:**
- Content-shaped skeletons for perceived performance
- 2-second timeout for "Still working..." in LoadingButton
- React.Profiler with 50ms threshold for bottleneck detection
- 5 sub-components memoized with React.memo
- 7 event handlers wrapped with useCallback
- O(1) Map-based task lookups via useMemo

---

## Milestone Summary

**Key Decisions:**
- 5-minute staleTime for data freshness (D-0901-01)
- Skip retry for 401/403 auth errors (D-0901-02)
- fetchQuery for utility hooks, useQuery for auto-fetch (D-1101-01)
- No toast on task completion — reduces noise (D-1203-01)
- Cursor-based pagination with created_at (D-1301-02)
- Shimmer via Tailwind gradient animation (D-1401-01)
- React.memo for calendar sub-components (D-1403-01)

**Issues Resolved:**
- Navigation felt slow → 5-min caching makes it instant
- Task completion had network delay → optimistic updates are instant
- Large people lists slow to load → infinite scroll with lazy loading
- CoachCalendar re-rendered excessively → selective memoization

**Issues Deferred:**
- Prefetching on hover (v2.1)
- Suspense integration (v2.1)
- Virtualized lists for 1000+ items (v2.1)

**Technical Debt Incurred:**
- None

---

_For current project status, see .planning/PROJECT.md_
