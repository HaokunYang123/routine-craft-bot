---
phase: 06-code-quality
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/hooks/useRecurringSchedules.ts
  - src/hooks/useGroups.ts
  - src/hooks/useProfile.ts
  - src/hooks/useTemplates.ts
  - src/hooks/useAssignments.ts
  - src/hooks/useStickers.ts
  - src/pages/GroupDetail.tsx
  - src/pages/coach/CoachCalendar.tsx
  - src/pages/coach/Assistant.tsx
  - src/pages/student/StudentSchedule.tsx
  - src/pages/student/StudentCalendar.tsx
  - src/pages/student/StudentSettings.tsx
  - src/pages/student/StudentHome.tsx
  - src/pages/AssignerDashboard.tsx
  - src/pages/Tasks.tsx
  - src/pages/People.tsx
  - src/pages/coach/CoachDashboard.tsx
  - src/pages/NotFound.tsx
  - src/pages/AssigneeDashboard.tsx
  - src/components/CheckInModal.tsx
  - src/components/QRScanner.tsx
  - src/components/StudentAuth.tsx
  - src/components/StudentDetailSheet.tsx
autonomous: true

must_haves:
  truths:
    - "All error catch blocks use handleError instead of console.error"
    - "Error logs include component name and action context"
    - "No duplicate toasts (handleError provides toast, manual toast calls removed)"
  artifacts:
    - path: "src/hooks/useRecurringSchedules.ts"
      provides: "Structured error handling in recurring schedules hook"
      contains: "handleError"
    - path: "src/hooks/useAssignments.ts"
      provides: "Structured error handling in assignments hook"
      contains: "handleError"
    - path: "src/pages/Tasks.tsx"
      provides: "Structured error handling in Tasks page"
      contains: "handleError"
    - path: "src/pages/coach/CoachCalendar.tsx"
      provides: "Structured error handling in CoachCalendar"
      contains: "handleError"
  key_links:
    - from: "catch blocks"
      to: "handleError"
      via: "import and call"
      pattern: "import.*handleError.*from.*@/lib/error"
    - from: "handleError calls"
      to: "context object"
      via: "component and action parameters"
      pattern: "handleError\\(.*\\{.*component.*action"
---

<objective>
Replace 59 console.error calls with structured handleError utility calls across hooks, pages, and components.

Purpose: Ensure all errors are logged with consistent structure (component, action, user context) for easier debugging, while providing user-friendly toast messages automatically.

Output: All console.error calls (except error boundaries and handleError internals) converted to handleError with appropriate context.
</objective>

<execution_context>
@/Users/haokunyang/.claude/get-shit-done/workflows/execute-plan.md
@/Users/haokunyang/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-code-quality/06-RESEARCH.md
@src/lib/error.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate console.error in hooks (19 calls in 6 files)</name>
  <files>
    - src/hooks/useRecurringSchedules.ts
    - src/hooks/useGroups.ts
    - src/hooks/useProfile.ts
    - src/hooks/useTemplates.ts
    - src/hooks/useAssignments.ts
    - src/hooks/useStickers.ts
  </files>
  <action>
For each hook file, add import and replace console.error + toast patterns:

**Pattern for hooks:**
```typescript
import { handleError } from "@/lib/error";

// BEFORE
} catch (error) {
  console.error("Error message:", error);
  toast({ title: "Error", description: "Message", variant: "destructive" });
}

// AFTER
} catch (error) {
  handleError(error, { component: 'useHookName', action: 'actionName' });
}
```

**useRecurringSchedules.ts** (5 calls at lines 124, 174, 204, 231, 267):
- Add `import { handleError } from "@/lib/error";`
- Replace each console.error + toast with:
  - Line 124: `handleError(error, { component: 'useRecurringSchedules', action: 'fetch schedules' })`
  - Line 174: `handleError(error, { component: 'useRecurringSchedules', action: 'create schedule' })`
  - Line 204: `handleError(error, { component: 'useRecurringSchedules', action: 'update schedule' })`
  - Line 231: `handleError(error, { component: 'useRecurringSchedules', action: 'delete schedule' })`
  - Line 267: `handleError(error, { component: 'useRecurringSchedules', action: 'toggle schedule' })`
- Remove the corresponding toast calls (handleError provides toast)

**useGroups.ts** (3 calls at lines 63, 110, 258):
- Add import
- Replace with context: `{ component: 'useGroups', action: 'fetch/create/delete' }`

**useProfile.ts** (2 calls at lines 62, 96):
- Add import
- Replace with context: `{ component: 'useProfile', action: 'fetch/update' }`

**useTemplates.ts** (4 calls at lines 87, 151, 228, 254):
- Add import
- Replace with context: `{ component: 'useTemplates', action: 'fetch/create/update/delete' }`

**useAssignments.ts** (4 calls at lines 141, 333, 385, 489):
- Add import
- Replace with context: `{ component: 'useAssignments', action: 'fetch/create/update/delete' }`

**useStickers.ts** (1 call at line 130):
- Add import
- Replace with context: `{ component: 'useStickers', action: 'award sticker' }`

**Important:** Remove all manual toast calls that follow console.error - handleError shows toast automatically.
  </action>
  <verify>
    - `grep -l "handleError" src/hooks/*.ts | wc -l` shows 6 files
    - `grep "console.error" src/hooks/useRecurringSchedules.ts src/hooks/useGroups.ts src/hooks/useProfile.ts src/hooks/useTemplates.ts src/hooks/useAssignments.ts src/hooks/useStickers.ts | wc -l` shows 0
    - `npm run build` succeeds
  </verify>
  <done>
    - All 6 hook files import handleError
    - 19 console.error calls replaced with handleError + context
    - No duplicate toast calls remain
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate console.error in pages (31 calls in 12 files)</name>
  <files>
    - src/pages/GroupDetail.tsx
    - src/pages/coach/CoachCalendar.tsx
    - src/pages/coach/Assistant.tsx
    - src/pages/student/StudentSchedule.tsx
    - src/pages/student/StudentCalendar.tsx
    - src/pages/student/StudentSettings.tsx
    - src/pages/student/StudentHome.tsx
    - src/pages/AssignerDashboard.tsx
    - src/pages/Tasks.tsx
    - src/pages/People.tsx
    - src/pages/coach/CoachDashboard.tsx
    - src/pages/NotFound.tsx
    - src/pages/AssigneeDashboard.tsx
  </files>
  <action>
For each page file, add import and replace console.error patterns:

**GroupDetail.tsx** (1 call at line 245):
- `handleError(error, { component: 'GroupDetail', action: 'fetch group' })`

**CoachCalendar.tsx** (5 calls at lines 232, 695, 747, 1356, 1380):
- `handleError(error, { component: 'CoachCalendar', action: 'fetch/update/delete' })`

**Assistant.tsx** (3 calls at lines 96, 187, 239):
- `handleError(error, { component: 'Assistant', action: 'fetch/submit/clear' })`

**StudentSchedule.tsx** (1 call at line 166):
- `handleError(error, { component: 'StudentSchedule', action: 'fetch schedule' })`
- Note: This file was already touched in plan 06-01, so the import may already exist

**StudentCalendar.tsx** (1 call at line 75):
- `handleError(error, { component: 'StudentCalendar', action: 'fetch calendar' })`

**StudentSettings.tsx** (3 calls at lines 70, 115, 127):
- `handleError(error, { component: 'StudentSettings', action: 'fetch/update/upload' })`

**StudentHome.tsx** (2 calls at lines 126, 253):
- `handleError(error, { component: 'StudentHome', action: 'fetch/complete' })`

**AssignerDashboard.tsx** (1 call at line 159):
- `handleError(error, { component: 'AssignerDashboard', action: 'fetch dashboard' })`

**Tasks.tsx** (8 calls at lines 177, 202, 252, 311, 317, 323, 340, 442):
- `handleError(error, { component: 'Tasks', action: 'fetch/create/update/delete' })`

**People.tsx** (3 calls at lines 135, 202, 236):
- `handleError(error, { component: 'People', action: 'fetch/invite/remove' })`

**CoachDashboard.tsx** (2 calls at lines 108, 158):
- `handleError(error, { component: 'CoachDashboard', action: 'fetch stats/assignments' })`

**NotFound.tsx** (1 call at line 8):
- `handleError(error, { component: 'NotFound', action: 'navigation', silent: true })`
- Use silent mode for 404 logging - no user toast needed

**AssigneeDashboard.tsx** (1 call at line 183):
- `handleError(error, { component: 'AssigneeDashboard', action: 'fetch dashboard' })`

**Important:** Remove all manual toast calls that follow console.error.
  </action>
  <verify>
    - `grep -l "handleError" src/pages/*.tsx src/pages/*/*.tsx 2>/dev/null | wc -l` shows all page files
    - `grep "console.error" src/pages/GroupDetail.tsx src/pages/Tasks.tsx src/pages/People.tsx | wc -l` shows 0
    - `npm run build` succeeds
  </verify>
  <done>
    - All 12 page files import handleError
    - 31 console.error calls replaced with handleError + context
    - NotFound.tsx uses silent mode
  </done>
</task>

<task type="auto">
  <name>Task 3: Migrate console.error in components (6 calls in 4 files)</name>
  <files>
    - src/components/CheckInModal.tsx
    - src/components/QRScanner.tsx
    - src/components/StudentAuth.tsx
    - src/components/StudentDetailSheet.tsx
  </files>
  <action>
For each component file, add import and replace console.error patterns:

**CheckInModal.tsx** (2 calls at lines 73, 95):
- Add `import { handleError } from "@/lib/error";`
- `handleError(error, { component: 'CheckInModal', action: 'fetch/submit' })`

**QRScanner.tsx** (1 call at line 25):
- `handleError(error, { component: 'QRScanner', action: 'scan' })`

**StudentAuth.tsx** (1 call at line 43):
- `handleError(error, { component: 'StudentAuth', action: 'authenticate' })`

**StudentDetailSheet.tsx** (2 calls at lines 97, 135):
- `handleError(error, { component: 'StudentDetailSheet', action: 'fetch/update' })`

**Important:** Remove all manual toast calls that follow console.error.
  </action>
  <verify>
    - `grep -l "handleError" src/components/CheckInModal.tsx src/components/QRScanner.tsx src/components/StudentAuth.tsx src/components/StudentDetailSheet.tsx | wc -l` shows 4
    - `grep "console.error" src/components/CheckInModal.tsx src/components/QRScanner.tsx src/components/StudentAuth.tsx src/components/StudentDetailSheet.tsx | wc -l` shows 0
    - `npm run build` succeeds
  </verify>
  <done>
    - All 4 component files import handleError
    - 6 console.error calls replaced with handleError + context
    - No duplicate toast calls remain
  </done>
</task>

</tasks>

<verification>
1. **No console.error in converted files:**
   ```bash
   # Should return 0 (excluding error boundaries and error.ts itself)
   CONSOLE_ERRORS=$(grep -r "console.error" src/hooks src/pages src/components --include="*.ts" --include="*.tsx" | \
     grep -v "AppErrorBoundary" | grep -v "RouteErrorBoundary" | grep -v "error.ts" | \
     grep -v "FloatingAI" | grep -v "useAIAssistant" | wc -l)
   [ "$CONSOLE_ERRORS" -eq 0 ] && echo "PASS: No console.error found" || echo "FAIL: $CONSOLE_ERRORS console.error calls remain"
   ```

2. **handleError imported in all converted files:**
   ```bash
   IMPORT_COUNT=$(grep -l "handleError" src/hooks/*.ts src/pages/*.tsx src/pages/*/*.tsx src/components/*.tsx 2>/dev/null | wc -l)
   [ "$IMPORT_COUNT" -ge 22 ] && echo "PASS: handleError imported in $IMPORT_COUNT files" || echo "FAIL: Only $IMPORT_COUNT files have handleError import"
   ```

3. **Build succeeds:** `npm run build` exits with code 0

4. **Context included in all calls:**
   ```bash
   # Verify all handleError calls include component and action context
   CONTEXT_COUNT=$(grep -r "handleError(.*{" src/hooks src/pages src/components --include="*.ts" --include="*.tsx" | \
     grep -v "error.ts" | grep "component:" | wc -l)
   [ "$CONTEXT_COUNT" -ge 56 ] && echo "PASS: $CONTEXT_COUNT handleError calls with context" || echo "FAIL: Only $CONTEXT_COUNT calls have context"
   ```

5. **No duplicate toasts:**
   ```bash
   # Files should not have both handleError AND toast.error in same catch block
   npm run build  # Build validates no runtime issues
   ```
</verification>

<success_criteria>
- [ ] 19 console.error calls in hooks converted to handleError
- [ ] 31 console.error calls in pages converted to handleError
- [ ] 6 console.error calls in components converted to handleError
- [ ] All handleError calls include `{ component: '...', action: '...' }` context
- [ ] No duplicate toast calls (removed manual toasts after console.error)
- [ ] AI retry loops (FloatingAI.tsx, useAIAssistant.ts) kept as-is (specialized format)
- [ ] Error boundaries (AppErrorBoundary, RouteErrorBoundary) kept as-is
- [ ] `npm run build` succeeds
- [ ] Requirement QUAL-05 satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/06-code-quality/06-02-SUMMARY.md`
</output>
