---
phase: 05-type-safety
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - src/hooks/useRecurringSchedules.ts
  - src/hooks/useTemplates.ts
  - src/hooks/useDeviceType.tsx
  - src/types/browser.d.ts
autonomous: true
requirement: TYPE-02

must_haves:
  truths:
    - "No `as any` or `as never` casts remain in hook files"
    - "All Supabase queries in hooks use proper table names without casts"
    - "Browser API types are properly declared"
  artifacts:
    - path: "src/hooks/useRecurringSchedules.ts"
      provides: "Recurring schedules hook"
      min_lines: 100
    - path: "src/hooks/useTemplates.ts"
      provides: "Templates hook"
      min_lines: 80
    - path: "src/types/browser.d.ts"
      provides: "Browser API type extensions"
      contains: "Navigator"
  key_links:
    - from: "src/hooks/useRecurringSchedules.ts"
      to: "src/integrations/supabase/types.ts"
      via: "Supabase client typed queries"
      pattern: 'from\\("recurring_schedules"\\)'
---

<objective>
Remove all `as any` and `as never` type casts from hook files by using the regenerated Supabase types.

Purpose: Hooks contain business logic that interacts with the database. Type casts hide potential bugs where queries might use wrong column names or return unexpected shapes. With proper types, TypeScript catches these errors at compile time.

Output: Hook files with zero type escape hatches, using proper Supabase types.
</objective>

<execution_context>
@/Users/haokunyang/.claude/get-shit-done/workflows/execute-plan.md
@/Users/haokunyang/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-type-safety/05-01-SUMMARY.md
@src/integrations/supabase/types.ts
@src/hooks/useRecurringSchedules.ts
@src/hooks/useTemplates.ts
@src/hooks/useDeviceType.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix useRecurringSchedules.ts type casts (7 casts)</name>
  <files>src/hooks/useRecurringSchedules.ts</files>
  <action>
Remove all `as any` and `as never` casts from useRecurringSchedules.ts.

Current casts to remove:
- Line 53: `.from("recurring_schedules" as never)` -> `.from("recurring_schedules")`
- Line 80: `.from("templates" as never)` -> `.from("templates")`
- Line 112: `.from("class_sessions" as never)` -> `.from("class_sessions")`
- Line 152: `.from("recurring_schedules" as any)` -> `.from("recurring_schedules")`
- Line 196: `.from("recurring_schedules" as any)` -> `.from("recurring_schedules")`
- Line 223: `.from("recurring_schedules" as any)` -> `.from("recurring_schedules")`
- Line 253: `supabase.rpc("generate_recurring_tasks" as any, {...})` -> `supabase.rpc("generate_recurring_tasks", {...})`

After removing casts, verify TypeScript doesn't complain about:
- Table names being unknown
- Column names in .eq(), .select(), etc.
- RPC function parameter types

If TypeScript errors occur:
- Check if table/function name matches exactly what's in types.ts
- Verify column names match schema
- May need to add explicit type annotations for returned data
  </action>
  <verify>
1. `grep -c "as any\|as never" src/hooks/useRecurringSchedules.ts` returns 0
2. `npx tsc --noEmit -p tsconfig.app.json 2>&1 | grep -c useRecurringSchedules` returns 0 (no type errors in this file)
  </verify>
  <done>
useRecurringSchedules.ts has zero `as any` or `as never` casts. All Supabase queries use proper table names recognized by the TypeScript compiler.
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix useTemplates.ts type casts (8 casts)</name>
  <files>src/hooks/useTemplates.ts</files>
  <action>
Remove all `as any` casts from useTemplates.ts.

Current casts to remove:
- Line 43: `.from("templates" as any)` -> `.from("templates")`
- Line 63: `.from("template_tasks" as any)` -> `.from("template_tasks")`
- Line 99: `.from("templates" as any)` -> `.from("templates")`
- Line 122: `.from("template_tasks" as any)` -> `.from("template_tasks")`
- Line 163: `.from("templates" as any)` -> `.from("templates")`
- Line 175: `.from("template_tasks" as any)` -> `.from("template_tasks")`
- Line 193: `.from("template_tasks" as any)` -> `.from("template_tasks")`
- Line 232: `.from("templates" as any)` -> `.from("templates")`

Also fix any callback parameter types that use `: any`:
- Line 61: `(template: any)` - Replace with proper Template type or inferred type

After removing casts, the file should have proper type inference for:
- Template and TemplateTask data shapes
- Insert/update objects matching table schema
  </action>
  <verify>
1. `grep -c "as any" src/hooks/useTemplates.ts` returns 0
2. `npx tsc --noEmit -p tsconfig.app.json 2>&1 | grep -c useTemplates` returns 0
  </verify>
  <done>
useTemplates.ts has zero `as any` casts. Template and TemplateTask queries use properly typed table names.
  </done>
</task>

<task type="auto">
  <name>Task 3: Fix useDeviceType.tsx and create browser type declarations (2 casts)</name>
  <files>src/hooks/useDeviceType.tsx, src/types/browser.d.ts</files>
  <action>
1. Create `src/types/browser.d.ts` with Navigator.standalone type extension:

```typescript
// Browser API type extensions for non-standard APIs
declare global {
  interface Navigator {
    /** iOS Safari standalone mode detection */
    standalone?: boolean;
  }
}

export {};
```

2. Update useDeviceType.tsx to remove casts:
- Line 15: `(window.navigator as any).standalone` -> `window.navigator.standalone`
- Line 40: `(window.navigator as any).standalone` -> `window.navigator.standalone`

3. Ensure the type declaration file is included in TypeScript compilation:
- Check that `src/types/` is within the `include` path in tsconfig.app.json (it should be since `"include": ["src"]`)

The Navigator.standalone property is a non-standard iOS Safari API that TypeScript doesn't know about by default. The declaration file tells TypeScript this property exists.
  </action>
  <verify>
1. `grep -c "as any" src/hooks/useDeviceType.tsx` returns 0
2. File exists: `test -f src/types/browser.d.ts && echo "exists"`
3. `npx tsc --noEmit -p tsconfig.app.json 2>&1 | grep -c useDeviceType` returns 0
  </verify>
  <done>
useDeviceType.tsx has zero `as any` casts. Browser-specific APIs are properly declared in src/types/browser.d.ts.
  </done>
</task>

</tasks>

<verification>
After completing all tasks:

1. **Zero casts in hooks:**
   ```bash
   grep -rn "as any\|as never" src/hooks/
   # Should return nothing
   ```

2. **TypeScript compiles hooks:**
   ```bash
   npx tsc --noEmit -p tsconfig.app.json 2>&1 | grep -E "useRecurringSchedules|useTemplates|useDeviceType"
   # Should return nothing (no errors)
   ```

3. **Browser types declared:**
   ```bash
   cat src/types/browser.d.ts
   # Should show Navigator interface with standalone property
   ```
</verification>

<success_criteria>
1. `grep -c "as any" src/hooks/useRecurringSchedules.ts` returns 0
2. `grep -c "as never" src/hooks/useRecurringSchedules.ts` returns 0
3. `grep -c "as any" src/hooks/useTemplates.ts` returns 0
4. `grep -c "as any" src/hooks/useDeviceType.tsx` returns 0
5. src/types/browser.d.ts exists with Navigator.standalone declaration
6. No TypeScript errors in hook files when running `npx tsc --noEmit`
</success_criteria>

<output>
After completion, create `.planning/phases/05-type-safety/05-02-SUMMARY.md`
</output>
