---
phase: 05-type-safety
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/integrations/supabase/types.ts
autonomous: true
requirement: TYPE-01

must_haves:
  truths:
    - "Supabase types include all tables in production database"
    - "Supabase types include all RPC functions in production database"
    - "TypeScript recognizes table names without casts"
  artifacts:
    - path: "src/integrations/supabase/types.ts"
      provides: "Database type definitions"
      contains: "recurring_schedules"
  key_links:
    - from: "src/integrations/supabase/types.ts"
      to: "supabase client"
      via: "Database generic type"
      pattern: "createClient<Database>"
---

<objective>
Regenerate Supabase TypeScript types from the live production database.

Purpose: The current types.ts only defines 8 tables, but the production database has 20+ tables and 6+ RPC functions. This mismatch forces developers to use `as any` casts for any table or function not in the types file. Regenerating types eliminates this gap at the source.

Output: Complete `src/integrations/supabase/types.ts` with all tables and RPC functions typed.
</objective>

<execution_context>
@/Users/haokunyang/.claude/get-shit-done/workflows/execute-plan.md
@/Users/haokunyang/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-type-safety/05-RESEARCH.md
@src/integrations/supabase/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Regenerate Supabase types from production database</name>
  <files>src/integrations/supabase/types.ts</files>
  <action>
Run the Supabase CLI type generation command:

```bash
npx supabase gen types typescript --project-id yklffwiyrfwcqkcnvetu > src/integrations/supabase/types.ts
```

After generation, verify the output includes:
1. All expected tables (recurring_schedules, templates, template_tasks, class_sessions, instructor_students, assignments, task_instances, groups, group_members, notes, etc.)
2. RPC functions section is populated (validate_qr_token, accept_invite, generate_recurring_tasks, get_group_stats, get_family_weekly_stats, generate_invite_code, delete_class_session, remove_student_from_class)

If the command fails due to authentication:
- Run `npx supabase login` first if needed
- Alternatively use `npx supabase gen types typescript --linked` if project is linked

Note: The generated file will completely replace the existing types.ts. This is expected - the old file was incomplete.
  </action>
  <verify>
1. Check file size increased significantly (was ~440 lines, should be 800+ lines)
2. Grep for key tables: `grep -c "recurring_schedules\|templates\|class_sessions" src/integrations/supabase/types.ts` should return 3+
3. Grep for RPC functions: `grep -c "validate_qr_token\|accept_invite\|generate_recurring_tasks" src/integrations/supabase/types.ts` should return 3+
4. TypeScript compiles: `npx tsc --noEmit -p tsconfig.app.json` (may have errors from other files, but types.ts itself should be valid)
  </verify>
  <done>
types.ts contains type definitions for all tables referenced in the codebase (recurring_schedules, templates, template_tasks, class_sessions, instructor_students, assignments, task_instances, notes, groups, group_members) and all RPC functions (validate_qr_token, accept_invite, generate_recurring_tasks, etc.)
  </done>
</task>

<task type="auto">
  <name>Task 2: Validate type generation completeness</name>
  <files>src/integrations/supabase/types.ts</files>
  <action>
Review the generated types.ts to confirm:

1. **Tables Section** - Verify these tables exist in Database["public"]["Tables"]:
   - recurring_schedules
   - recurring_schedule_assignments
   - templates
   - template_tasks
   - class_sessions
   - instructor_students
   - assignments
   - task_instances
   - groups
   - group_members
   - notes
   - (plus existing: chat_messages, people, profiles, routines, tasks, stickers, user_stickers, student_logs)

2. **Functions Section** - Verify Database["public"]["Functions"] contains:
   - validate_qr_token
   - accept_invite
   - generate_recurring_tasks
   - get_group_stats
   - get_family_weekly_stats
   - generate_invite_code (or generate_join_code)
   - delete_class_session
   - remove_student_from_class

3. **Type Helpers** - Confirm helper types are present:
   - Tables<T>
   - TablesInsert<T>
   - TablesUpdate<T>

If any expected table or function is missing, document which ones. These may indicate:
- Table/function doesn't exist in production (needs migration)
- Different naming in database vs code

No code changes in this task - just validation and documentation.
  </action>
  <verify>
Create a checklist in the summary noting which tables/functions were found vs expected.
  </verify>
  <done>
Generated types have been validated. Any gaps between expected and actual types are documented.
  </done>
</task>

</tasks>

<verification>
After completing both tasks:

1. **Type file validity:**
   ```bash
   head -50 src/integrations/supabase/types.ts  # Check structure
   grep -c "Tables:" src/integrations/supabase/types.ts  # Should show Tables section
   ```

2. **Table coverage:**
   ```bash
   grep "recurring_schedules:" src/integrations/supabase/types.ts
   grep "templates:" src/integrations/supabase/types.ts
   grep "class_sessions:" src/integrations/supabase/types.ts
   ```

3. **Function coverage:**
   ```bash
   grep "validate_qr_token:" src/integrations/supabase/types.ts
   grep "accept_invite:" src/integrations/supabase/types.ts
   ```
</verification>

<success_criteria>
1. src/integrations/supabase/types.ts regenerated from production database
2. All tables referenced in codebase have type definitions (or gaps documented)
3. All RPC functions referenced in codebase have type definitions (or gaps documented)
4. TypeScript recognizes the Database type export
5. Subsequent plans (05-02, 05-03, 05-04) can remove `as any` casts using these types
</success_criteria>

<output>
After completion, create `.planning/phases/05-type-safety/05-01-SUMMARY.md`
</output>
